<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crop Price Prediction System</title>
    <style>
        :root {
            --primary-color: #2e7d32;
            --primary-light: #60ad5e;
            --primary-dark: #005005;
            --secondary-color: #ffd54f;
            --text-on-primary: #ffffff;
            --text-primary: #212121;
            --text-secondary: #757575;
            --background-color: #f9fbf7;
            --card-color: #ffffff;
            --error-color: #d32f2f;
            --success-color: #388e3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5rem;
            color: var(--secondary-color);
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            main {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 25px;
            height: 100%;
        }

        .card-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        select, input, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }

        .range-slider {
            width: 100%;
            margin-top: 10px;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        button i {
            font-size: 1.2rem;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .secondary-button {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .secondary-button:hover {
            background-color: rgba(46, 125, 50, 0.1);
        }

        .result-card {
            display: none;
            margin-top: 30px;
        }

        .price-prediction {
            text-align: center;
            padding: 20px;
            margin: 20px 0;
            background-color: rgba(46, 125, 50, 0.1);
            border-radius: 8px;
        }

        .predicted-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .price-range {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .prediction-date {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .quality-factors {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .legend-color {
            display: inline-block;
            width: 15px;
            height: 15px;
            margin-right: 5px;
            border-radius: 3px;
        }
        
        .pie-slice {
            transition: opacity 0.3s;
            cursor: pointer;
        }
        
        .pie-slice:hover {
            opacity: 0.8;
        }
        
        #qualityFactorsChart {
            margin: 15px auto;
            text-align: center;
        }

        .factor-item {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }

        .factor-value {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-color);
        }

        .factor-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .recommendations {
            margin-top: 20px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .recommendation-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .recommendation-icon {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-top: 3px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            display: none;
            background-color: #ffebee;
            color: var(--error-color);
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .data-source {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 20px;
            text-align: right;
        }

        /* Icon styles */
        .material-icons {
            font-family: 'Material Icons';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
        }

        footer {
            margin-top: 50px;
            border-top: 1px solid #eee;
            padding-top: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-links {
            display: flex;
            gap: 20px;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
        }

        .footer-links a:hover {
            color: var(--primary-color);
        }
    </style>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <span class="material-icons logo-icon">agriculture</span>
                <div class="logo-text">
                    <h1>Crop Price Prediction System</h1>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <main>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">grass</span>
                        Enter Crop Details
                    </div>
                    <div class="card-subtitle">Provide information about your crop for accurate price prediction</div>
                </div>

                <div class="error-message" id="errorMessage"></div>

                <form id="cropPredictionForm">
                    <div class="form-group">
                        <label for="cropType">Crop Type</label>
                        <select id="cropType" required>
                            <option value="" disabled selected>Select crop type</option>
                            <option value="rice">Rice</option>
                            <option value="wheat">Wheat</option>
                            <option value="maize">Maize</option>
                            <option value="chickpea">Chickpea</option>
                            <option value="cotton">Cotton</option>
                            <option value="sugarcane">Sugarcane</option>
                            <option value="soybean">Soybean</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="cropVariety">Crop Variety</label>
                        <select id="cropVariety" required>
                            <option value="" disabled selected>Select crop variety</option>
                            <!-- Will be populated based on crop type -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="region">Growing Region</label>
                        <select id="region" required>
                            <option value="" disabled selected>Select region</option>
                            <option value="north">North India</option>
                            <option value="south">South India</option>
                            <option value="east">East India</option>
                            <option value="west">West India</option>
                            <option value="central">Central India</option>
                            <option value="northeast">Northeast India</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="harvestDate">Harvest Date</label>
                        <input type="date" id="harvestDate" required>
                    </div>

                    <div class="form-group">
                        <label for="moistureContent">Moisture Content (%)</label>
                        <input type="range" id="moistureContent" class="range-slider" min="8" max="25" step="0.1" value="14">
                        <div class="range-labels">
                            <span>8%</span>
                            <span id="moistureValue">14%</span>
                            <span>25%</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="grainSize">Grain Size/Quality</label>
                        <select id="grainSize" required>
                            <option value="premium">Premium Grade</option>
                            <option value="standard" selected>Standard Grade</option>
                            <option value="basic">Basic Grade</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="impurities">Impurities (%)</label>
                        <input type="range" id="impurities" class="range-slider" min="0" max="10" step="0.1" value="2">
                        <div class="range-labels">
                            <span>0%</span>
                            <span id="impuritiesValue">2%</span>
                            <span>10%</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="quantity">Estimated Quantity (quintals)</label>
                        <input type="number" id="quantity" min="1" placeholder="Enter quantity" required>
                    </div>

                    <div class="form-group">
                        <label for="organicStatus">Cultivation Method</label>
                        <select id="organicStatus" required>
                            <option value="organic">Organic (Certified)</option>
                            <option value="natural">Natural Farming (Non-certified)</option>
                            <option value="conventional" selected>Conventional</option>
                        </select>
                    </div>

                    <div class="actions">
                        <button type="button" class="secondary-button" id="resetButton">
                            <span class="material-icons">refresh</span>
                            Reset
                        </button>
                        <button type="submit" id="predictButton">
                            <span class="material-icons">analytics</span>
                            Predict Price
                        </button>
                    </div>
                </form>
                <div class="loading" id="loadingIndicator">
                    <div class="loading-spinner"></div>
                    <p>Analyzing crop data and market conditions...</p>
                </div>
            </div>
            <div id="qualityFactorsChart" style="display: none;"></div>
            <div class="card result-card" id="resultCard">
                <div class="card-header">
                    <div class="card-title">
                        <span class="material-icons">paid</span>
                        Price Prediction Results
                    </div>
                    <div class="card-subtitle">Based on current market trends and your crop details</div>
                </div>

                <div class="price-prediction">
                    <p>Estimated Market Price</p>
                    <div class="predicted-price" id="predictedPrice">₹0.00</div>
                    <div class="price-range" id="priceRange">₹0.00 - ₹0.00 per quintal</div>
                    <div class="prediction-date" id="predictionDate">As of today</div>
                </div>

                <h3>Quality Factors Affecting Price</h3>
                <div class="quality-factors">
                    <div class="factor-item">
                        <div class="factor-value" id="moistureImpact">+0.0%</div>
                        <div class="factor-label">Moisture</div>
                    </div>
                    <div class="factor-item">
                        <div class="factor-value" id="qualityImpact">+0.0%</div>
                        <div class="factor-label">Quality</div>
                    </div>
                    <div class="factor-item">
                        <div class="factor-value" id="impuritiesImpact">+0.0%</div>
                        <div class="factor-label">Impurities</div>
                    </div>
                    <div class="factor-item">
                        <div class="factor-value" id="organicImpact">+0.0%</div>
                        <div class="factor-label">Cultivation</div>
                    </div>
                </div>

                <h3>Market Insights & Recommendations</h3>
                <div class="recommendations">
                    <div class="recommendation-item">
                        <span class="material-icons recommendation-icon">schedule</span>
                        <div class="recommendation-text" id="timingRecommendation">
                            Consider optimal timing for selling your crop.
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <span class="material-icons recommendation-icon">location_on</span>
                        <div class="recommendation-text" id="marketRecommendation">
                            Check prices at nearby markets for better deals.
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <span class="material-icons recommendation-icon">trending_up</span>
                        <div class="recommendation-text" id="trendRecommendation">
                            Market trends suggest price stability in the coming weeks.
                        </div>
                    </div>
                </div>

                <div class="data-source">
                    Data sources: Agricultural Market Information System, Regional Mandi Prices, Historical Trends
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-content">
                <div>© 2025 Crop Price Prediction System | All Rights Reserved</div>
                <div class="footer-links">
                    <a href="#">Agritech</a>
                    
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Crop varieties based on crop type
const cropVarieties = {
    rice: ["Basmati", "Sona Masuri", "Ponni", "IR-8", "Jaya"],
    wheat: ["HD-2967", "PBW-343", "Lok-1", "WH-542", "DBW-17"],
    maize: ["DHM-117", "Ganga-11", "Deccan-103", "KH-517", "MMH-69"],
    chickpea: ["JG-11", "Vijay", "Digvijay", "KWR-108", "Pusa-362"],
    cotton: ["Suraj", "LRA-5166", "MCU-5", "Bunny", "DCH-32"],
    sugarcane: ["CO-86032", "CO-0238", "CO-0118", "BO-91", "CoJ-85"],
    soybean: ["JS-335", "PS-1042", "MACS-1188", "NRC-86", "JS-9752"]
};

// Base prices per quintal for each crop (in INR)
const basePrices = {
    rice: {
        "Basmati": 3500,
        "Sona Masuri": 2800,
        "Ponni": 2500,
        "IR-8": 2200,
        "Jaya": 2300
    },
    wheat: {
        "HD-2967": 2200,
        "PBW-343": 2150,
        "Lok-1": 2100,
        "WH-542": 2000,
        "DBW-17": 2050
    },
    maize: {
        "DHM-117": 1950,
        "Ganga-11": 1850,
        "Deccan-103": 1900,
        "KH-517": 1800,
        "MMH-69": 1950
    },
    chickpea: {
        "JG-11": 5100,
        "Vijay": 4900,
        "Digvijay": 5000,
        "KWR-108": 4800,
        "Pusa-362": 5200
    },
    cotton: {
        "Suraj": 6500,
        "LRA-5166": 6300,
        "MCU-5": 6700,
        "Bunny": 6800,
        "DCH-32": 7000
    },
    sugarcane: {
        "CO-86032": 350,
        "CO-0238": 380,
        "CO-0118": 360,
        "BO-91": 340,
        "CoJ-85": 330
    },
    soybean: {
        "JS-335": 4200,
        "PS-1042": 4100,
        "MACS-1188": 4300,
        "NRC-86": 4000,
        "JS-9752": 4150
    }
};

// DOM Elements
const cropTypeSelect = document.getElementById('cropType');
const cropVarietySelect = document.getElementById('cropVariety');
const moistureSlider = document.getElementById('moistureContent');
const moistureValue = document.getElementById('moistureValue');
const impuritiesSlider = document.getElementById('impurities');
const impuritiesValue = document.getElementById('impuritiesValue');
const predictionForm = document.getElementById('cropPredictionForm');
const resetButton = document.getElementById('resetButton');
const loadingIndicator = document.getElementById('loadingIndicator');
const resultCard = document.getElementById('resultCard');
const errorMessage = document.getElementById('errorMessage');

// Update moisture content display
moistureSlider.addEventListener('input', function() {
    moistureValue.textContent = this.value + '%';
});

// Update impurities display
impuritiesSlider.addEventListener('input', function() {
    impuritiesValue.textContent = this.value + '%';
});

// Populate crop varieties based on crop type selection
cropTypeSelect.addEventListener('change', function() {
    const selectedCrop = this.value;
    cropVarietySelect.innerHTML = '<option value="" disabled selected>Select crop variety</option>';
    
    if (selectedCrop && cropVarieties[selectedCrop]) {
        cropVarieties[selectedCrop].forEach(variety => {
            const option = document.createElement('option');
            option.value = variety;
            option.textContent = variety;
            cropVarietySelect.appendChild(option);
        });
        cropVarietySelect.disabled = false;
    } else {
        cropVarietySelect.disabled = true;
    }
});

// Reset form
resetButton.addEventListener('click', function() {
    predictionForm.reset();
    resultCard.style.display = 'none';
    errorMessage.style.display = 'none';
    cropVarietySelect.innerHTML = '<option value="" disabled selected>Select crop variety</option>';
    cropVarietySelect.disabled = true;
    moistureValue.textContent = '14%';
    impuritiesValue.textContent = '2%';
    document.getElementById('qualityFactorsChart').style.display = 'none';
});

// Form submission
predictionForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Basic validation
    const cropType = cropTypeSelect.value;
    const cropVariety = cropVarietySelect.value;
    
    if (!cropType || !cropVariety) {
        showError("Please select both crop type and variety");
        return;
    }
    
    // Show loading state
    loadingIndicator.style.display = 'block';
    resultCard.style.display = 'none';
    errorMessage.style.display = 'none';
    
    // Simulate API call with setTimeout
    setTimeout(calculatePrice, 1500);
});

// Calculate price based on inputs
function calculatePrice() {
    try {
        const cropType = cropTypeSelect.value;
        const cropVariety = cropVarietySelect.value;
        const region = document.getElementById('region').value;
        const harvestDate = document.getElementById('harvestDate').value;
        const moistureContent = parseFloat(moistureSlider.value);
        const grainQuality = document.getElementById('grainSize').value;
        const impurities = parseFloat(impuritiesSlider.value);
        const quantity = parseInt(document.getElementById('quantity').value);
        const organicStatus = document.getElementById('organicStatus').value;
        
        // Get base price
        let basePrice = basePrices[cropType][cropVariety];
        if (!basePrice) {
            throw new Error("Price data not available for selected crop and variety");
        }
        
        // Calculate adjustments
        let moistureAdjustment = 0;
        let qualityAdjustment = 0;
        let impuritiesAdjustment = 0;
        let organicAdjustment = 0;
        
        // Moisture content adjustment
        const optimalMoisture = 14;
        if (moistureContent < optimalMoisture) {
            moistureAdjustment = (optimalMoisture - moistureContent) * 0.5; // 0.5% price increase per 1% lower moisture
        } else if (moistureContent > optimalMoisture) {
            moistureAdjustment = (optimalMoisture - moistureContent) * 1.0; // 1% price decrease per 1% higher moisture
        }
        
        // Quality adjustment
        switch (grainQuality) {
            case 'premium':
                qualityAdjustment = 8; // 8% premium
                break;
            case 'standard':
                qualityAdjustment = 0; // No adjustment
                break;
            case 'basic':
                qualityAdjustment = -5; // 5% reduction
                break;
        }
        
        // Impurities adjustment
        if (impurities <= 2) {
            impuritiesAdjustment = 2; // 2% premium for very clean crop
        } else if (impurities > 5) {
            impuritiesAdjustment = -1 * (impurities - 5); // Penalty for high impurities
        }
        
        // Organic status adjustment
        switch (organicStatus) {
            case 'organic':
                organicAdjustment = 15; // 15% premium for certified organic
                break;
            case 'natural':
                organicAdjustment = 5; // 5% premium for natural farming
                break;
            default:
                organicAdjustment = 0;
        }
        
        // Region and seasonal adjustments (simplified)
        const regionFactors = {
            'north': 1.02,
            'south': 1.03,
            'east': 0.98,
            'west': 1.01,
            'central': 1.00,
            'northeast': 0.97
        };
        
        const regionFactor = regionFactors[region] || 1.0;
        
        // Calculate total adjustments
        const totalAdjustmentPercent = moistureAdjustment + qualityAdjustment + impuritiesAdjustment + organicAdjustment;
        const adjustmentFactor = 1 + (totalAdjustmentPercent / 100);
        
        // Apply adjustments to base price
        const adjustedPrice = basePrice * adjustmentFactor * regionFactor;
        
        // Calculate price range (±5% from predicted price)
        const minPrice = adjustedPrice * 0.95;
        const maxPrice = adjustedPrice * 1.05;
        
        // Display results
        displayResults({
            price: adjustedPrice.toFixed(2),
            minPrice: minPrice.toFixed(2),
            maxPrice: maxPrice.toFixed(2),
            moisture: moistureAdjustment.toFixed(1),
            quality: qualityAdjustment.toFixed(1),
            impurities: impuritiesAdjustment.toFixed(1),
            organic: organicAdjustment.toFixed(1),
            region: region,
            harvestDate: new Date(harvestDate).toLocaleDateString(),
            cropType: cropType,
            cropVariety: cropVariety
        });
        
    } catch (error) {
        console.error("Calculation error:", error);
        showError("Error calculating price: " + error.message);
    } finally {
        loadingIndicator.style.display = 'none';
    }
}

// Display results on the page
function displayResults(results) {
    document.getElementById('predictedPrice').textContent = '₹' + results.price;
    document.getElementById('priceRange').textContent = '₹' + results.minPrice + ' - ₹' + results.maxPrice + ' per quintal';
    document.getElementById('predictionDate').textContent = 'As of ' + new Date().toLocaleDateString();
    
    // Quality factors
    document.getElementById('moistureImpact').textContent = (results.moisture > 0 ? '+' : '') + results.moisture + '%';
    document.getElementById('moistureImpact').style.color = results.moisture >= 0 ? 'var(--success-color)' : 'var(--error-color)';
    
    document.getElementById('qualityImpact').textContent = (results.quality > 0 ? '+' : '') + results.quality + '%';
    document.getElementById('qualityImpact').style.color = results.quality >= 0 ? 'var(--success-color)' : 'var(--error-color)';
    
    document.getElementById('impuritiesImpact').textContent = (results.impurities > 0 ? '+' : '') + results.impurities + '%';
    document.getElementById('impuritiesImpact').style.color = results.impurities >= 0 ? 'var(--success-color)' : 'var(--error-color)';
    
    document.getElementById('organicImpact').textContent = (results.organic > 0 ? '+' : '') + results.organic + '%';
    document.getElementById('organicImpact').style.color = results.organic >= 0 ? 'var(--success-color)' : 'var(--error-color)';
    
    // Recommendations
    generateRecommendations(results);
    
    // Create quality factors pie chart
    createQualityFactorsPieChart(results);
    
    // Show results
    resultCard.style.display = 'block';
}

// Create a pie chart to visualize the quality factors
function createQualityFactorsPieChart(results) {
    // Get the positive impact values (convert negative values to 0)
    const moistureImpact = Math.max(0, parseFloat(results.moisture));
    const qualityImpact = Math.max(0, parseFloat(results.quality));
    const impuritiesImpact = Math.max(0, parseFloat(results.impurities));
    const organicImpact = Math.max(0, parseFloat(results.organic));
    
    // Total positive impact
    const totalPositiveImpact = moistureImpact + qualityImpact + impuritiesImpact + organicImpact;
    
    // If there's no positive impact, don't show the chart
    if (totalPositiveImpact <= 0) {
        document.getElementById('qualityFactorsChart').style.display = 'none';
        return;
    }
    
    // Calculate percentages
    const moisturePercentage = (moistureImpact / totalPositiveImpact) * 100;
    const qualityPercentage = (qualityImpact / totalPositiveImpact) * 100;
    const impuritiesPercentage = (impuritiesImpact / totalPositiveImpact) * 100;
    const organicPercentage = (organicImpact / totalPositiveImpact) * 100;
    
    // Prepare data for the pie chart
    const data = [
        { label: 'Moisture', value: moisturePercentage, color: '#4CAF50' },
        { label: 'Quality', value: qualityPercentage, color: '#2196F3' },
        { label: 'Impurities', value: impuritiesPercentage, color: '#FFC107' },
        { label: 'Cultivation', value: organicPercentage, color: '#9C27B0' }
    ];
    
    // Filter out zero values
    const filteredData = data.filter(item => item.value > 0);
    
    // Create SVG element
    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(svgNS, "svg");
    svg.setAttribute("width", "100%");
    svg.setAttribute("height", "200");
    svg.setAttribute("viewBox", "0 0 200 200");
    
    // Chart dimensions
    const centerX = 100;
    const centerY = 100;
    const radius = 80;
    
    // Draw pie slices
    let startAngle = 0;
    const legend = document.createElement('div');
    legend.className = 'chart-legend';
    
    filteredData.forEach(slice => {
        // Calculate angles in radians
        const sliceAngle = (slice.value / 100) * Math.PI * 2;
        const endAngle = startAngle + sliceAngle;
        
        // Calculate coordinates
        const startX = centerX + radius * Math.cos(startAngle);
        const startY = centerY + radius * Math.sin(startAngle);
        const endX = centerX + radius * Math.cos(endAngle);
        const endY = centerY + radius * Math.sin(endAngle);
        
        // Determine if the slice is a large arc (more than 180 degrees)
        const largeArcFlag = sliceAngle > Math.PI ? 1 : 0;
        
        // Create path for slice
        const path = document.createElementNS(svgNS, "path");
        const d = [
            `M ${centerX},${centerY}`,
            `L ${startX},${startY}`,
            `A ${radius},${radius} 0 ${largeArcFlag},1 ${endX},${endY}`,
            'Z'
        ].join(' ');
        
        path.setAttribute("d", d);
        path.setAttribute("fill", slice.color);
        path.setAttribute("stroke", "#fff");
        path.setAttribute("stroke-width", "1");
        
        // Add hover effect
        path.setAttribute("data-label", slice.label);
        path.setAttribute("data-value", slice.value.toFixed(1) + "%");
        path.setAttribute("class", "pie-slice");
        
        svg.appendChild(path);
        
        // Update start angle for next slice
        startAngle = endAngle;
        
        // Create legend item
        const legendItem = document.createElement('div');
        legendItem.className = 'legend-item';
        legendItem.innerHTML = `
            <span class="legend-color" style="background-color: ${slice.color}"></span>
            <span class="legend-label">${slice.label}: ${slice.value.toFixed(1)}%</span>
        `;
        legend.appendChild(legendItem);
    });
    
    // Clear and add new chart
    const chartContainer = document.getElementById('qualityFactorsChart');
    chartContainer.innerHTML = '';
    chartContainer.appendChild(svg);
    chartContainer.appendChild(legend);
    chartContainer.style.display = 'block';
}

// Generate personalized recommendations
function generateRecommendations(results) {
    const timingRecommendation = document.getElementById('timingRecommendation');
    const marketRecommendation = document.getElementById('marketRecommendation');
    const trendRecommendation = document.getElementById('trendRecommendation');
    
    // Timing recommendation based on harvest date
    const harvestDate = new Date(results.harvestDate);
    const currentDate = new Date();
    const daysSinceHarvest = Math.floor((currentDate - harvestDate) / (1000 * 60 * 60 * 24));
    
    if (daysSinceHarvest < 0) {
        timingRecommendation.textContent = "Your harvest is planned in the future. Consider pre-selling contracts for price security.";
    } else if (daysSinceHarvest < 15) {
        timingRecommendation.textContent = "Recently harvested crop. Consider storing for 3-4 weeks if storage facilities are available as prices tend to stabilize after initial harvest influx.";
    } else if (daysSinceHarvest < 45) {
        timingRecommendation.textContent = "Optimal selling window for your crop based on harvest timing. Market prices are typically balanced now.";
    } else {
        timingRecommendation.textContent = "Your crop was harvested some time ago. If quality is maintained, consider selling soon to avoid further storage costs and quality degradation.";
    }
    
    // Market recommendation based on region
    switch(results.region) {
        case 'north':
            marketRecommendation.textContent = "North India markets show strong demand for " + results.cropType + ". Consider government procurement centers for MSP benefits.";
            break;
        case 'south':
            marketRecommendation.textContent = "South India has premium buyers for quality " + results.cropType + ". Export-oriented buyers offer better prices for premium grades.";
            break;
        case 'east':
            marketRecommendation.textContent = "Check prices at multiple mandis in Eastern region as price variation is higher. Consider farmer producer organizations for collective selling.";
            break;
        case 'west':
            marketRecommendation.textContent = "Western markets have strong processing industry demand. Direct selling to processors may yield better prices.";
            break;
        case 'central':
            marketRecommendation.textContent = "Central region has stable demand. Compare prices between government procurement and private traders.";
            break;
        case 'northeast':
            marketRecommendation.textContent = "Northeast markets value organic produce highly. Highlight cultivation practices for better prices.";
            break;
        default:
            marketRecommendation.textContent = "Compare prices at different market yards and procurement centers near you for the best deals.";
    }
    
    // Trend recommendation based on crop type
    switch(results.cropType) {
        case 'rice':
            trendRecommendation.textContent = "Rice prices are expected to remain stable with slight upward trend in the coming month due to steady demand.";
            break;
        case 'wheat':
            trendRecommendation.textContent = "Wheat prices are projected to rise by 2-4% in the next 3-4 weeks due to reduced imports and steady demand.";
            break;
        case 'maize':
            trendRecommendation.textContent = "Poultry industry demand is driving maize prices up. Expect 3-5% increase in the short term.";
            break;
        case 'chickpea':
            trendRecommendation.textContent = "Chickpea prices are stabilizing after recent fluctuations. Current prices reflect market equilibrium.";
            break;
        case 'cotton':
            trendRecommendation.textContent = "Textile industry demand is strong. Premium quality cotton like yours may see price improvements in coming weeks.";
            break;
        case 'sugarcane':
            trendRecommendation.textContent = "Government-regulated prices provide stability. Focus on quality parameters to maximize returns.";
            break;
        case 'soybean':
            trendRecommendation.textContent = "Soybean prices are trending upward due to export demand. Consider holding for 2-3 weeks if storage is available.";
            break;
        default:
            trendRecommendation.textContent = "Market trends suggest price stability in the coming weeks.";
    }
}

// Show error message
function showError(message) {
    errorMessage.textContent = message;
    errorMessage.style.display = 'block';
    loadingIndicator.style.display = 'none';
}

// Set current date as default harvest date
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const formattedDate = today.toISOString().split('T')[0];
    document.getElementById('harvestDate').value = formattedDate;
});
    </script>
    </body>
    </html>